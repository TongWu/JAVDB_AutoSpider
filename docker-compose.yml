version: '3.8'

services:
  javdb-spider:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: javdb-spider
    restart: unless-stopped
    
    # Environment variables for cron jobs
    env_file:
      - .env
    
    # Mount volumes
    volumes:
      # Mount config.py (must exist on host)
      - ./config.py:/app/config.py:ro
      
      # Mount logs directory (read-write)
      - ./logs:/app/logs
      
      # Mount Ad Hoc directory (read-write)
      - ./Ad Hoc:/app/Ad Hoc
      
      # Mount Daily Report directory (read-write)
      - ./Daily Report:/app/Daily Report
      
      # Optional: Mount parsed movies history if you want to preserve it
      # - ./parsed_movies_history.csv:/app/parsed_movies_history.csv
    
    # Set timezone
    environment:
      - TZ=Asia/Shanghai
    
    # Health check (optional)
    healthcheck:
      test: ["CMD", "pgrep", "cron"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    
    # Resource limits (optional, adjust as needed)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 2G
    #     reservations:
    #       cpus: '0.5'
    #       memory: 512M

# Optional: create named volumes for better data management
# volumes:
#   logs:
#   ad_hoc:
#   daily_report:

