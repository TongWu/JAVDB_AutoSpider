# JavDB Auto Spider - Unified Configuration File
# Copy this file to config.py and update with your actual credentials

# =============================================================================
# GIT CONFIGURATION
# =============================================================================

# GitHub username
GIT_USERNAME = 'your_github_username'

# GitHub password or personal access token
# Note: It's recommended to use a personal access token instead of password
# Generate one at: GitHub Settings → Developer settings → Personal access tokens
GIT_PASSWORD = 'your_github_password_or_token'

# GitHub repository URL
# Format: https://github.com/username/repository.git
GIT_REPO_URL = 'https://github.com/your_username/your_repo_name.git'

# Git branch to push to (usually 'main' or 'master')
GIT_BRANCH = 'main'

# =============================================================================
# QBITTORRENT CONFIGURATION
# =============================================================================

# qBittorrent Web UI settings
QB_HOST = 'your_qbittorrent_ip'
QB_PORT = 'your_qbittorrent_port'
QB_USERNAME = 'your_qbittorrent_username'
QB_PASSWORD = 'your_qbittorrent_password'

# Torrent settings
TORRENT_CATEGORY = 'JavDB'  # Category for all JavDB torrents
TORRENT_CATEGORY_ADHOC = 'Ad Hoc'  # Category for adhoc mode torrents
TORRENT_SAVE_PATH = ''  # Leave empty for default path
AUTO_START = True  # Set to False to add torrents in paused state
SKIP_CHECKING = False  # Set to True to skip hash checking

# Connection settings
REQUEST_TIMEOUT = 30  # Timeout for API requests in seconds
DELAY_BETWEEN_ADDITIONS = 1  # Delay between adding torrents in seconds

# =============================================================================
# SMTP CONFIGURATION (for email notifications)
# =============================================================================

# SMTP server settings
SMTP_SERVER = 'smtp.gmail.com'
SMTP_PORT = 587

# Email credentials
SMTP_USER = 'your_email@gmail.com'
SMTP_PASSWORD = 'your_email_password_or_app_password'

# Email addresses
EMAIL_FROM = 'your_email@gmail.com'
EMAIL_TO = 'your_email@gmail.com'

# =============================================================================
# PROXY CONFIGURATION
# =============================================================================

# PROXY MODE SELECTION
# Choose between single proxy or proxy pool
# Options:
#   'single' - Use only the first proxy (main proxy) from PROXY_POOL
#   'pool'   - Use proxy pool with automatic failover (recommended for better reliability)
PROXY_MODE = 'single'

# =============================================================================
# UNIFIED PROXY CONFIGURATION
# =============================================================================

# Proxy pool - List of proxies for use in both single and pool modes
# 
# IMPORTANT: 
#   - In 'single' mode: Only the FIRST proxy is used (main proxy)
#   - In 'pool' mode: All proxies are used with automatic failover
#
# Each proxy should be a dictionary with 'http', 'https', and optional 'name' keys
# Supported formats:
#   HTTP: 'http://proxy.example.com:8080'
#   HTTPS: 'https://proxy.example.com:8080'
#   SOCKS5: 'socks5://proxy.example.com:1080'
#   With auth: 'http://username:password@proxy.example.com:8080'
#
# IMPORTANT: If your password contains special characters, you need to URL-encode them:
#   Space     -> %20
#   !         -> %21
#   #         -> %23
#   $         -> %24
#   %         -> %25
#   &         -> %26
#   @         -> %40
#   :         -> %3A (only in password, not after @)
#   /         -> %2F
#   ?         -> %3F
#   =         -> %3D
#   +         -> %2B
#
# Example: password "My@Pass!" should be "My%40Pass%21"
# You can use Python to encode: from urllib.parse import quote; print(quote("My@Pass!", safe=''))

PROXY_POOL = [
    # Main proxy (used in both single and pool modes)
    {
        'name': 'Main-Proxy',
        'http': 'http://127.0.0.1:7890',
        'https': 'http://127.0.0.1:7890'
    },
    # Backup proxy 1 (only used in pool mode)
    {
        'name': 'Backup-Proxy-1',
        'http': 'http://127.0.0.1:7891',
        'https': 'http://127.0.0.1:7891'
    },
    # Backup proxy 2 (only used in pool mode)
    # {
    #     'name': 'Backup-Proxy-2',
    #     'http': 'http://127.0.0.1:7892',
    #     'https': 'http://127.0.0.1:7892'
    # },
    # Example with authentication (password with special chars encoded)
    # {
    #     'name': 'Auth-Proxy',
    #     'http': 'http://username:My%40Pass%21@proxy.example.com:8080',
    #     'https': 'http://username:My%40Pass%21@proxy.example.com:8080'
    # },
    # Example SOCKS5 proxy (requires: pip install requests[socks])
    # {
    #     'name': 'SOCKS5-Proxy',
    #     'http': 'socks5://127.0.0.1:1080',
    #     'https': 'socks5://127.0.0.1:1080'
    # },
]

# Proxy pool behavior settings (only applies when PROXY_MODE = 'pool')
# IMPORTANT: JavDB bans IPs for 7 days, so cooldown is set to 8 days (691200 seconds)
# Ban records are persistent across runs and stored in Daily Report/proxy_bans.csv
PROXY_POOL_COOLDOWN_SECONDS = 691200  # 8 days (691200 seconds)
PROXY_POOL_MAX_FAILURES = 3  # Max consecutive failures before putting proxy in cooldown

# =============================================================================
# LEGACY PROXY CONFIGURATION (DEPRECATED - for backward compatibility only)
# =============================================================================
# These settings are deprecated. Please use PROXY_POOL above instead.
# If set, these will override the first entry in PROXY_POOL for backward compatibility.
PROXY_HTTP = None  # Deprecated: Use PROXY_POOL instead
PROXY_HTTPS = None  # Deprecated: Use PROXY_POOL instead

# Proxy modules control (which parts of the script use proxy when --use-proxy is enabled)
# Available modules:
#   'spider'      - All JavDB requests (index pages, detail pages, login/session refresh)
#   'qbittorrent' - qBittorrent Web UI API requests
#   'pikpak'      - PikPak bridge qBittorrent API requests
# Add module names to the list to enable proxy for those modules
# Leave empty list [] to disable proxy for all modules
# Use ['all'] to enable proxy for all modules
PROXY_MODULES = ['all']

# Example configurations:
# PROXY_MODULES = ['all']  # Enable proxy for all modules (default)
# PROXY_MODULES = ['spider']  # Only spider (including login), not qBittorrent/PikPak
# PROXY_MODULES = ['spider', 'qbittorrent']  # Spider and qBittorrent
# PROXY_MODULES = ['qbittorrent', 'pikpak']  # Only qBittorrent and PikPak, not spider
# PROXY_MODULES = []  # Disable proxy for all modules (even if --use-proxy is set)

# =============================================================================
# CLOUDFLARE BYPASS CONFIGURATION
# =============================================================================

# CloudflareBypassForScraping service configuration
# Deploy the service from: https://github.com/sarperavci/CloudflareBypassForScraping
# Run with: docker compose up -d (default port: 8000)
#
# The service URL is dynamically generated based on proxy configuration:
#   - Without proxy: http://localhost:{CF_BYPASS_SERVICE_PORT}
#   - With proxy pool: http://{PROXY_IP}:{CF_BYPASS_SERVICE_PORT}
#     (uses the IP from current proxy in the pool)
#
# IMPORTANT: Deploy the CF bypass service on each proxy server using the same port
CF_BYPASS_SERVICE_PORT = 8000

# =============================================================================
# SPIDER CONFIGURATION
# =============================================================================

# Page range for spider
START_PAGE = 1
END_PAGE = 20

# Phase 2 config
PHASE2_MIN_RATE = 4.0
PHASE2_MIN_COMMENTS = 100

# Base URL for JavDB
BASE_URL = 'https://javdb.com'

# =============================================================================
# JAVDB LOGIN CONFIGURATION (for automatic session cookie refresh)
# =============================================================================

# JavDB login credentials (optional - for automatic cookie refresh)
# Fill in your credentials and run: python3 scripts/login.py
JAVDB_USERNAME = ''  # Your JavDB email or username
JAVDB_PASSWORD = ''  # Your JavDB password

# GPT API for AI-powered captcha solving (recommended - most accurate)
# Uses GPT-4o Vision to recognize captcha images
# Compatible with OpenAI API or any OpenAI-compatible API (e.g., api.gpt.ge)
GPT_API_URL = 'https://api.gpt.ge/v1/chat/completions'  # API endpoint
GPT_API_KEY = ''  # Your API key (e.g., sk-xxx)

# JavDB session cookie (can be auto-updated by scripts/login.py)
# Manual method: Get from browser → Developer Tools → Application → Cookies → _jdb_session
# Automatic method: Set credentials above and run: python3 scripts/login.py
JAVDB_SESSION_COOKIE = ''

# Sleep time configuration (in seconds)
DETAIL_PAGE_SLEEP = 5  # Sleep time before parsing detail pages to avoid DDoS protection
PAGE_SLEEP = 2  # Sleep time between pages
MOVIE_SLEEP = 1  # Sleep time between movies

# Cloudflare protection handling
CF_TURNSTILE_COOLDOWN = 10  # Sleep time when Cloudflare Turnstile verification page is detected
PHASE_TRANSITION_COOLDOWN = 30  # Sleep time between Phase 1 and Phase 2 to avoid triggering Cloudflare
FALLBACK_COOLDOWN = 30  # Cooldown time after a successful fallback before processing next item

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL = 'INFO'

# Log file paths
SPIDER_LOG_FILE = 'logs/spider.log'
UPLOADER_LOG_FILE = 'logs/qb_uploader.log'
PIPELINE_LOG_FILE = 'logs/pipeline.log'
EMAIL_NOTIFICATION_LOG_FILE = 'logs/email_notification.log'

# =============================================================================
# PARSING CONFIGURATION
# =============================================================================

# Whether to ignore today/yesterday release tags and parse all entries with subtitles
# If True: Parse all entries with subtitle tags regardless of release date tags
# If False: Only parse entries that have both subtitle tags AND today/yesterday tags
IGNORE_RELEASE_DATE_FILTER = False

# Whether to include movies in report even if all torrent categories are already downloaded
# If True: Include movies in report with [DOWNLOADED PREVIOUSLY] markers for already downloaded categories
# If False: Skip movies where all available torrent categories are already in history (default)
INCLUDE_DOWNLOADED_IN_REPORT = False

# =============================================================================
# FILE PATHS
# =============================================================================

# Reports root directory (contains history files and report subdirectories)
REPORTS_DIR = 'reports'

# Output directories for CSV reports (inside REPORTS_DIR)
# Reports are stored in REPORTS_DIR/DailyReport/YYYY/MM/ and REPORTS_DIR/AdHoc/YYYY/MM/
DAILY_REPORT_DIR = 'reports/DailyReport'
AD_HOC_DIR = 'reports/AdHoc'

# History file (stored directly in REPORTS_DIR)
PARSED_MOVIES_CSV = 'parsed_movies_history.csv'

# =============================================================================
# PikPak Information
# =============================================================================
PIKPAK_EMAIL = "me@example.com"
PIKPAK_PASSWORD = "password"
PIKPAK_LOG_FILE = "logs/pikpak_bridge.log"

# Delay between PikPak offline download requests (in seconds)
# This helps avoid rate limiting when processing multiple torrents
PIKPAK_REQUEST_DELAY = 3

# =============================================================================
# qBittorrent File Filter Configuration
# =============================================================================

# Minimum file size threshold in MB
# Files smaller than this will be set to "do not download" priority
# This helps filter out small files like NFO, samples, screenshots, etc.
QB_FILE_FILTER_MIN_SIZE_MB = 100

# Log file for the file filter script
QB_FILE_FILTER_LOG_FILE = 'logs/qb_file_filter.log'
